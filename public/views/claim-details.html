<div ng-include="'views/nav.html'"></div>
<div class="container">
    <div class="alert alert-dismissible alert-danger" ng-hide="errorMsg.length===0">
        <button type="button" class="close" data-dismiss="alert" ng-click="closeErrorMsg()">×</button>
        {{errorMsg}}
    </div>
    <div class="alert alert-dismissible alert-success" ng-hide="successMsg.length===0">
        <button type="button" class="close" data-dismiss="alert" ng-click="closeSuccessMsg()">×</button>
        <strong>{{successMsg}}</strong>
    </div>

    <div class="panel-group" id="accordion">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title pull-left">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse1" ng-click="collapse_click($event)">Claim Details</a>
                </h3>
                <button type="submit" class="btn btn-default pull-right" ng-click="refresh()"><i class="fa fa-refresh"></i><span>&nbsp;&nbsp;Refresh</span></button>
                <div class="clearfix"></div>
            </div>
            <div id="collapse1" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-sm-2 well well-sm">
                                - Claim Progression:
                            </div>
                            <div class="col-sm-10 well-sm">
                                <div class="row bs-wizard">
                                    <div class="col-sm-2 bs-wizard-step" ng-class="{'active': claim.customerStatus==0,'complete':claim.customerStatus >0}">
                                        <div ng-if="claim.customerStatus==0" class="text-center bs-wizard-stepnum" data-toggle="popover" data-placement="top" data-content="{{claim.updatedDate|date:'MM/dd/yyyy h:mma'}}" data-trigger="hover" >New Claim</div>
                                        <div ng-if="claim.customerStatus!=0" class="text-center bs-wizard-stepnum" >New Claim</div>
                                        <div class="progress"><div class="progress-bar"></div></div>
                                        <span class="bs-wizard-dot"></span>
                                    </div>

                                    <div class="col-sm-2 bs-wizard-step" ng-class="{'active': claim.customerStatus==1,'complete':claim.customerStatus >1,'disabled':claim.customerStatus <1}">
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus==1" data-toggle="popover" data-placement="top" data-content="{{claim.updatedDate|date:'MM/dd/yyyy h:mma'}}" data-trigger="hover">Claim Started</div>
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus!=1">Claim Started</div>
                                        <div class="progress"><div class="progress-bar"></div></div>
                                        <span class="bs-wizard-dot"></span>
                                    </div>

                                    <div class="col-sm-2 bs-wizard-step" ng-class="{'active': claim.customerStatus==2,'complete':claim.customerStatus >2,'disabled':claim.customerStatus <2}">
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus==2" data-toggle="popover" data-placement="top" data-content="{{claim.updatedDate|date:'MM/dd/yyyy h:mma'}}" data-trigger="hover">Damage Captured</div>
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus!=2">Damage Captured</div>
                                        <div class="progress"><div class="progress-bar"></div></div>
                                        <span class="bs-wizard-dot"></span>
                                        <span class="bs-wizard-dot"></span>
                                    </div>

                                    <div class="col-sm-2 bs-wizard-step" ng-class="{'active': claim.customerStatus==3,'complete':claim.customerStatus >3,'disabled':claim.customerStatus <3}">
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus==3" data-toggle="popover" data-placement="top" data-content="{{claim.updatedDate|date:'MM/dd/yyyy h:mma'}}" data-trigger="hover">Photos Captured</div>
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus!=3">Photos Captured</div>
                                        <div class="progress"><div class="progress-bar"></div></div>
                                        <span class="bs-wizard-dot"></span>
                                        <span class="bs-wizard-dot"></span>
                                    </div>

                                    <div class="col-sm-2 bs-wizard-step" ng-class="{'active': claim.customerStatus==5,'complete':claim.customerStatus >5,'disabled':claim.customerStatus <5}">
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus==5" data-toggle="popover" data-placement="top" data-content="{{claim.updatedDate|date:'MM/dd/yyyy h:mma'}}" data-trigger="hover">Claim Submitted</div>
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus!=5">Claim Submitted</div>
                                        <div class="progress"><div class="progress-bar"></div></div>
                                        <span class="bs-wizard-dot"></span>
                                        <span class="bs-wizard-dot"></span>
                                    </div>

                                    <div class="col-sm-2 bs-wizard-step" ng-class="{'active': claim.customerStatus==6,'complete':claim.customerStatus >6,'disabled':claim.customerStatus <6}">
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus==6" data-toggle="popover" data-placement="top" data-content="{{claim.updatedDate|date:'MM/dd/yyyy h:mma'}}" data-trigger="hover">Estimate Ready</div>
                                        <div class="text-center bs-wizard-stepnum" ng-if="claim.customerStatus!=6">Estimate Ready</div>
                                        <div class="progress"><div class="progress-bar"></div></div>
                                        <span class="bs-wizard-dot"></span>
                                        <span class="bs-wizard-dot"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-2 well well-sm">
                                - Claim Number:
                            </div>
                            <div class="col-sm-4 well well-sm">
                                {{claim.claimNumber}}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-2 well well-sm">
                                - Claim Status:
                            </div>
                            <div class="col-sm-4 well well-sm">
                                {{getClaimStatus(claim)}}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-2 well well-sm">
                                - Passcode:
                            </div>
                            <div class="col-sm-4 well well-sm">
                                {{claim.userName}}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-2 well well-sm">
                                - Creation Date:
                            </div>
                            <div class="col-sm-4 well well-sm">
                                {{claim.createdDate | date:'MM/dd/yyyy h:mma'}}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-2 well well-sm">
                                - Estimate Net Total:
                            </div>
                            <div class="col-sm-4 well well-sm">
                                {{getEstimateNetTotal() | currency}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse7" ng-click="collapse_click($event)">Vehicle Owner Details</a>
                </h4>
            </div>
            <div id="collapse7" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-3 well well-sm">
                            - First Name:
                        </div>
                        <div class="col-sm-4 well well-sm">
                            {{claim.vehicleOwnerFirstName}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-3 well well-sm">
                            - Email:
                        </div>
                        <div class="col-sm-4 input-group">
                            <input type="text" ng-model="claim.vehicleOwnerEmail" class="form-control" id="vehicle_owner_email" placeholder="Email">
                            <span class="input-group-addon"><i class="fa fa-envelope"></i></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-3 well well-sm">
                            - Cell phone:
                        </div>
                        <div class="col-sm-4 input-group">
                            <input type="text" phone-input ng-model="claim.vehicleOwnerCellPhone"  class="form-control" id="vehicle_owner_cellphone" placeholder="Cell Phone">
                            <span class="input-group-addon"><i class="fa fa-phone"></i></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-3 well well-sm">
                            - Communication Preference:
                        </div>
                        <div class="col-sm-4 input-group">
                            <select ng-init="comm.value = claim.communicationPreference" class="form-control"  id="select_communication_preference"
                                    ng-model="claim.communicationPreference" ng-options="comm.value as comm.name for comm in communications">
                            </select>
                            <span class="input-group-addon"><i class="fa fa-flag-o"></i></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <button type="reset" class="btn btn-default" ng-click="cancel()"><i class="fa fa-ban"></i>&nbsp;&nbsp;Cancel</button>&nbsp;&nbsp;
                            <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#confirmDialog"><i class="fa fa-check"></i>&nbsp;&nbsp;Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse6" ng-click="collapse_click($event)">Estimate Details</a>
                </h4>
            </div>
            <div id="collapse6" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-4">
                            <input class="form-control" type="file" id="estimateReportInput" accept="application/pdf"/>
                        </div>
                        <div class="col-sm-4">
                            <button class="btn btn-primary" id="estimateReportButton" data-toggle="modal" ng-click="openDialog('estimateNetTotalDialog')" ><i class="fa fa-check"></i>&nbsp;&nbsp;Submit</button>
                        </div>
                        <div class="col-sm-4">
                            <button  class="btn btn-primary" ng-click="resendestimate()" ng-show="claim.customerStatus>=6"><i class="fa fa-file-pdf-o"></i>&nbsp;&nbsp;Resend estimate</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse4" ng-click="collapse_click($event)"> Actions</a>
                </h4>
            </div>
            <div id="collapse4" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="form-group">
                        <button  class="btn btn-primary" ng-click="resendpasscode()" ng-disabled="claim.isPasswordExpired || !claim.userName"><i class="fa fa-key"></i>&nbsp;&nbsp;Resend passcode</button>
                        <button  class="btn btn-primary" ng-click="resendestimate()" ng-show="claim.customerStatus>=6"><i class="fa fa-file-pdf-o"></i>&nbsp;&nbsp;Resend estimate</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default" ng-show="submitedImages.length > 0">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse5" ng-click="collapse_click($event)">Submitted Photos</a>
                </h4>
            </div>
            <div id="collapse5" class="panel-collapse collapse">
                <div class="panel-body">
                    <table>
                        <tr  ng-repeat="rows in submitedImages">
                            <td  ng-repeat="image in rows">
                                <label class="control-label left_padding" ng-show="image.content!=null" ng-hide="image.content==null">{{image.name}}</label>
                                <img class="img-rounded" hspace="15" vspace="15" ng-click="displayLargePhoto(image.content)" ng-src="data:image/jpeg;base64,{{image.content}}" ng-show="image.content!=null" ng-hide="image.content==null">
                                <img width="340" hspace="15" vspace="15" height="256" src="images/spinner.gif" ng-hide="image.content!=null" ng-show="image.content==null">
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="panel panel-default" ng-show ="surveyDatas.questionsRatings != null">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse2" ng-click="collapse_click($event)">Survey Data</a>
                </h4>
            </div>
            <div id="collapse2" class="panel-collapse collapse">
                <div class="panel-body">
                  <!--  -->
                  <div class="panel panel-default" ng-show ="surveyDatas.questionsRatings != null">
   <div class="panel-body">
   <div class="row">
   <div class="col-sm-8">
   <table class="table table-striped">
   <tr>
   <td>Q1: Was the app easy to use?</td>
   <td>{{surveyDatas.questionsRatings.q1rating}}</td>
   </tr>
   <tr>
   <td>Q2: In the event of another claim, how likely are you to use the app again?</td>
   <td>{{surveyDatas.questionsRatings.q2rating}}</td>
   </tr>
   <tr>
   <td>Q3: How likely are you to recommend it to someone else?</td>
   <td>{{surveyDatas.questionsRatings.q3rating}}</td>
   </tr>
   <tr>
   <td>Average Survey Score</td>
   <td>{{(surveyDatas.questionsRatings.q1rating + surveyDatas.questionsRatings.q2rating + surveyDatas.questionsRatings.q3rating)/3}}</td>
   </tr>
   <tr>
   <td>Comments</td>
   <td>
   <div ng-show="surveyDatas.comments!=null">{{surveyDatas.comments}}</div>
   <div ng-show="surveyDatas.comments==null">N/A</div>
   </td>
   </tr>
   </table>   
   </div>
   </div>
   </div>
                  <!--  -->
                </div>
            </div>
        </div>

        <div class="panel panel-default" ng-show="eventList.length > 0">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse3" ng-click="collapse_click($event)">Claim Metrics</a>
                </h4>
            </div>
            <div id="collapse3" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="input-group">
                                <input type="text" ng-model="searchEventName" placeholder="Event Name" class="form-control">
                                <span class="input-group-addon"><i class="fa fa-filter"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8">
                            <table class="table table-striped table-hover" ng-show="showMetricsflag" >
                                <thead>
                                <tr>
                                    <th>
                                        <a href="#/claim-details" ng-click="sortType = 'eventName'; sortReverse = !sortReverse">
                                            Event
                                            <span ng-show="sortType == 'eventName' && sortReverse" class="fa fa-caret-down"></span>
                                            <span ng-show="sortType == 'eventName' && !sortReverse" class="fa fa-caret-up"></span>
                                        </a>
                                    </th>
                                    <th>
                                        <a href="#/claim-details" ng-click="sortType = 'createdDate'; sortReverse = !sortReverse">
                                            Time
                                            <span ng-show="sortType == 'createdDate' && sortReverse" class="fa fa-caret-down"></span>
                                            <span ng-show="sortType == 'createdDate' && !sortReverse" class="fa fa-caret-up"></span>
                                        </a>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="event in eventList | filter:{eventName:searchEventName} | orderBy:sortType:sortReverse" ng-class="getHighlight(event)">
                                    <td>{{event.eventName}}</td>
                                    <td>{{event.createdDate| date:'MM/dd/yyyy, h:mma'}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div ng-include="'views/dialogs.html'"></div>
</div>
